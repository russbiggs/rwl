define(function(){"use strict";function s(s){let t=s.slice(0,-2),e=s.slice(-2),n=parseInt(t)+.01*parseFloat(e);return parseFloat(n.toFixed(2))}return function(t){const e={},n=t.split("\n").slice(0,3);e.metadata=function(t){const e={},n=t;e.siteId=n[0].slice(0,6).replace(/\s*/g,"");const i=n[0].slice(9).match(/(\w+)/g);e.siteName=i.slice(0,-1).join(" "),e.speciesCode=i.slice(-1)[0];const a=n[1].split(/\s{2,}/);e.state=a[1].match(/2\s([A-Za-z\s]+)/)[1],e.species=n[1].match(/\d+[A-Za-z\s]+\s\s+([A-Za-z\s\-\']+)\b\s\s+\d/)[1];const c=n[1].match(/(\d+)M/)[1];e.elevation=c;let o=n[1].match(/\s(\d+\-*\s*\d+)\s/)[1];o.indexOf(" ")>-1&&(o=o.split(/\s+/)),o.indexOf("-")>-1&&(o=o.split("-"));const r=s(o[1]),l=s(o[0]);e.location={type:"Feature",properties:{},geometry:{type:"Point",coordinates:[r,l]}};const[p,d]=n[1].match(/(\d{4})\s*(\d{4})\s*$/).slice(1);return e.firstYear=parseInt(p),e.lastYear=parseInt(d),e.leadInvestigator=(m=n[2],m.match(/\w+\s+3\s(.*)/)[1].split(/(\s\band\b\s)|\s{2,}|\,\s+/).filter(s=>!!s))[0],e;var m}(n);const i=t.split("\n").slice(3);return e.samples=function(s){const t=s,e=[];for(const s of t){const t={},n=s.split(/\s+/g);t.sampleId=n[0];const i=n.slice(1),a=parseInt(i.shift()),c=[];for(let s=0;s<i.length;s++){const t={};t.year=a+s,t.width=parseInt(i[s]);const e=[999,-9999];console.log(e.indexOf(t.width)),-1==e.indexOf(t.width)&&c.push(t)}t.measurements=c,e.push(t)}const n=e.reduce((s,t)=>(s[t.sampleId]=s[t.sampleId]||[],s[t.sampleId].push(...t.measurements),s),{}),i=[];for(const s in n)i.push({sampleId:s,measurements:n[s]});return i}(i),JSON.stringify(e)}});